require("cn:components/mz-scroll/mz-scroll");var $=require("cn:components/jquery/jquery"),template=require("cn:components/artTemplate/artTemplate"),Swiper=require("cn:components/swiper/swiper"),$sliderList,$sliderListNew=[],sliderLength,Dms=function(e,t){this.blockIds=e||"",this.callBack=t,this.dmsUrl="https://dms-dataapi.meizu.com/data/jsdata.jsonp",this.dmsPrevUrl="https://dms.meizu.com/api/preview/jsdataPreview.jsonp",this.url="",this.callBackName=t.name?t.name:"dmsCallback_"+(new Date).getTime(),this.init()};Dms.prototype.init=function(){this.setCallBack(),this.getDmsData(),this.createJsonp(),void 0==window.getPrice&&(window.getPrice=this.getPrice)},Dms.prototype.createJsonp=function(){var e=document.createElement("script");e.src=this.url,document.body.appendChild(e)},Dms.prototype.getDmsData=function(){var e=this.getQueryString("preview");if(e){var t=this.getQueryString("blockIds")||"",a=this.getQueryString("blockDataIds")||"";this.url="https://dms.meizu.com/api/preview/jsdataPreview.jsonp?blockIds="+t+"&blockDataIds="+a+"&callback="+this.callBackName}else this.url=this.dmsUrl+"?callback="+this.callBackName+"&blockIds="+this.blockIds},Dms.prototype.setCallBack=function(){window[this.callBackName]=this.callBack},Dms.prototype.getQueryString=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(t);return null!=a?unescape(a[2]):null},Dms.prototype.getPrice=function(e,t){var a={};return e.forEach(function(e){e.skuId===t&&(a.price=Number(e.skuPrice),a.minPrice=""===e.skuMinPrice?"":Number(e.skuMinPrice))}),a};var staticTplData={data:{data:{Category:{data:[]},CarouselFigure:{data:[]},AdvFloor:{data:[]},PhoneFloor:{data:[]},AudioFloor:{data:[]},PartsFloor:{data:[]},BigAdvFloor:{data:[]},HouseFloor:{data:[]},ServiceFloor:{data:[]},CommentFloor:{data:[]},VideoFloor:{data:[]},FlymeFloor:{data:[]}}},show:!1},IndexRender={tplData:staticTplData.data,videoUrl:"",isWebkit:"WebkitAppearance"in document.documentElement.style,init:function(){new Dms("268,269,363,298,299,274,352,358,359,360",this.indexDmsCB)},saveDmsData:function(e,t){localStorage.setItem(e,JSON.stringify(t))},indexDmsCB:function(e){void 0!==e.code&&0==e.code?(e=JSON.parse(window.localStorage.dmsData_index),console.warn("dms 接口请求失败，当前使用本地缓存数据，请检查接口")):IndexRender.saveDmsData("dmsData_index",e);for(var t in e){var a=e[t],i=0;if("skuInfo"!==t)for(;i<a.length;){if(a[i].skuid){var n=getPrice(e.skuInfo,a[i].skuid);a[i].price=n.price,a[i].minPrice=n.minPrice}i++}}IndexRender.tplData.data.CarouselFigure.data=e.block_268,IndexRender.tplData.data.AdvFloor.data=e.block_269,IndexRender.tplData.data.PhoneFloor.data=e.block_363,IndexRender.tplData.data.AudioFloor.data=e.block_358,IndexRender.tplData.data.PartsFloor.data=e.block_359,IndexRender.tplData.data.HouseFloor.data=e.block_360,IndexRender.tplData.data.BigAdvFloor.data=e.block_274,IndexRender.tplData.data.CommentFloor.data=e.block_298,IndexRender.tplData.data.VideoFloor.data=e.block_299,IndexRender.tplData.data.FlymeFloor.data=e.block_352,IndexRender.render(),IndexRender.BBSinit()},render:function(){var e=this,t={"mz-index-banner":"CarouselFigure","index-adv-center":"AdvFloor","index-phone-center":"PhoneFloor","index-parts-center":"PartsFloor","index-house-center":"HouseFloor","index-audio-center":"AudioFloor","index-comment-center":"CommentFloor","index-video-center":"VideoFloor","index-flyme-center":"FlymeFloor"};for(var a in t)document.getElementById(a).innerHTML=template(t[a],e.tplData);e.setSign(),e.swiperInit(),e.videoInit(),e.imgLazyLoad()},setSign:function(){$(".product-sign").each(function(){var e=$(this),t=e.data("color");e.addClass(t)})},swiperInit:function(){new Swiper(".swiper-container-banner",{pagination:".pagination",autoplay:8e3,autoplayDisableOnInteraction:!1,loop:!0,paginationClickable:!0,onSwiperCreated:function(){$sliderList=$("#mz-index-banner .swiper-slide"),$sliderList.each(function(e,t){var a=$(t);a.hasClass("swiper-slide-duplicate")||$sliderListNew.push(a)}),sliderLength=$sliderListNew.length,sliderLength&&($("#mz-index-banner").parent("div").addClass("theme-"+$sliderListNew[0].attr("data-theme")),$(".button-wrapper a").show())},onSlideChangeEnd:function(e){var t=e.activeIndex-1;t==sliderLength?t=0:-1==t&&(t=sliderLength-1);var a=$sliderListNew[t].attr("data-theme");$("#mz-index-banner").parent("div").removeClass().addClass("container theme-"+("gray"==a?"gray":"white"))}})},BBSinit:function(){function e(){$.ajax({url:"https://bbs-app.meizu.cn/index.php",data:{mod:"thread",action:"info",tids:a},type:"get",dataType:"jsonp",jsonpCallback:"callback",success:function(e){if(200==e.code){var a=$(".section-comment-box");e.data.list.forEach(function(e,i){a.find(".user-header").eq(i).attr("src",e.avatar),a.find(".comment-username").eq(i).text(e.author),a.find(".box-img").eq(i).attr("href","https://bbs.meizu.cn/thread-"+t[i]+"-1-1.html")})}}})}var t=[];$.each(IndexRender.tplData.data.CommentFloor.data,function(e,a){t.push(a.commentId)});var a=t.join(",");t.length>0&&e()},videoInit:function(){this.videoWp=$('<div class="flyme-win video-win"></div');var e='<div class="flyme-win__con">                          <div class="flyme-win__conin">                              <video id="flyme_video" class="video-js vjs-default-skin vjs-big-play-centered"                               controls preload="none" width="960" height="540" poster="">                                  <source src="https://cimg2.res.meizu.com/www/201809/pc-16X产品视频不带价格_1.mp4" type="video/mp4">                              </video>                          </div>                        </div>                        <a class="iconflyme flyme-win__close" data-close-btn href="javascript:void(0);"></a>';this.videoWp.html(e),$("body").append(this.videoWp),this.videoCloseBtn=$(".flyme-win__close"),this.player=window.videojs("flyme_video"),this.videoEvent()},videoEvent:function(){var e=this;$(".jpVideo").on("click",function(){if(e.videoUrl!==$(this).data("video")){var t=$(this).data("video");e.videoUrl=t,e.player.src(e.videoUrl),e.videoPlay()}else e.videoPlay()}),this.videoCloseBtn.on("click",function(){e.videoClose()})},videoClose:function(){this.player.pause(),this.videoWp.hide()},videoPlay:function(){this.videoWp.show(),this.player.play()},imgLazyLoad:function(){$(".lazy-img").addScroll({once:!0,topOffset:400,bottomOffset:100,scrollIn:function(){var e=$(this),t=e.data("img"),a=e.data("retina");e.attr(a&&t?{src:t,srcset:a}:{src:t})}})}};$(function(){IndexRender.init()});